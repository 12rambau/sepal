const {stream} = require('sepal/httpServer')

const sceneAreas$ = require('root/jobs/ee/image/sceneAreas')
const preview$ = require('root/jobs/ee/image/preview')
const imageBands$ = require('root/jobs/ee/image/bands')
const imageGeometry$ = require('root/jobs/ee/image/geometry')
const tableColumns$ = require('root/jobs/ee/table/columns')
const tableColumnValues$ = require('root/jobs/ee/table/columnValues')
const tableQuery$ = require('root/jobs/ee/table/query')
const tableMap$ = require('root/jobs/ee/table/map')
const check$ = require('root/jobs/ee/check')
// const recipeGeometry$ = require('root/jobs/ee/table/map')
const testHttp$ = require('root/jobs/test/http')
const testHttpDirect$ = require('root/jobs/test/http/test')
const testWs$ = require('root/jobs/test/ws')

module.exports = router =>
    router
        .post('/sceneareas', stream(ctx => sceneAreas$(ctx)))
        .post('/preview', stream(ctx => preview$(ctx)))
        .post('/bands', stream(ctx => imageBands$(ctx)))
        .post('/recipe/geometry', stream(ctx => imageGeometry$(ctx)))
        .get('/table/columns', stream(ctx => tableColumns$(ctx)))
        .get('/table/columnValues', stream(ctx => tableColumnValues$(ctx)))
        .post('/table/query', stream(ctx => tableQuery$(ctx)))
        .get('/table/map', stream(ctx => tableMap$(ctx)))
        .get('/test/:min/:max/:errorProbability', stream(ctx => testHttp$(ctx)))
        .get('/test2/:min/:max/:errorProbability', stream(
            ({params: {min, max, errorProbability}}) => testHttpDirect$(parseInt(min), parseInt(max), parseInt(errorProbability))
        ))
        .get('/ws/:name', stream(ctx => testWs$(ctx)))
        .get('/healthcheck', stream(ctx => check$(ctx)))
